<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Mobile-OK ì§€ì‹ë² ì´ìŠ¤ ê´€ë¦¬</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        body { background-color: #f4f7f6; font-family: 'Pretendard', sans-serif; }
        .container { max-width: 1200px; }
        .card { border: none; border-radius: 15px; box-shadow: 0 10px 20px rgba(0,0,0,0.05); margin-bottom: 25px; }
        .table { background: white; border-radius: 10px; overflow: hidden; }
        .btn-primary { background-color: #007bff; border: none; font-weight: bold; }
        .nav-link { font-weight: 600; color: #495057; }
        .text-truncate-multiline { display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
    </style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm sticky-top mb-4">
    <div class="container">
        <a class="navbar-brand fw-bold text-primary" href="/">Mobile-OK Diagnostic</a>
        <div class="navbar-nav ms-auto">
            <a class="nav-item nav-link" href="/">ğŸ  í™ˆ</a>
            <a class="nav-item nav-link" href="/dashboard">ğŸ” ì§„ë‹¨ ëŒ€ì‹œë³´ë“œ</a>
            <a class="nav-item nav-link active" href="/admin/management">âš™ï¸ ì§€ì‹ ë² ì´ìŠ¤ ê´€ë¦¬</a>
        </div>
    </div>
</nav>

<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="fw-bold text-dark">Mobile-OK ì§€ì‹ë² ì´ìŠ¤ ê´€ë¦¬</h1>
    </div>

    <div class="card p-4 mb-4">
        <h5 class="fw-bold mb-3">ìƒˆë¡œìš´ í•´ê²° ì‚¬ë¡€ ë“±ë¡</h5>
        <div class="row g-3">
            <div class="col-md-2">
                <label class="form-label fw-bold">ì—ëŸ¬ ì½”ë“œ</label>
                <input type="text" id="errorCode" class="form-control" placeholder="ì˜ˆ: 5033">
            </div>
            <div class="col-md-5">
                <label class="form-label fw-bold">ìš”ì²­ ìƒì„¸ ìš”ê±´ (ì´ë©”ì¼ ì›ë¬¸ ë“±)</label>
                <textarea id="requestDetail" class="form-control" rows="3" placeholder="ìƒì„¸ ìš”ì²­ ë§¥ë½ì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
            </div>
            <div class="col-md-5">
                <label class="form-label fw-bold">í•´ê²° ë°©ë²• ë° ê°€ì´ë“œ</label>
                <textarea id="resolution" class="form-control" rows="3" placeholder="í•´ê²° ë°©ë²• ë° ê°€ì´ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
            </div>
            <div class="col-md-2">
                <label class="form-label fw-bold">ìƒíƒœ</label>
                <select id="status" class="form-select">
                    <option value="ì™„ë£Œ">ì™„ë£Œ</option>
                    <option value="ë¯¸ì™„ë£Œ">ë¯¸ì™„ë£Œ</option>
                </select>
            </div>
            <div class="col-md-10 d-flex align-items-end">
                <button class="btn btn-primary w-100" onclick="saveCase()">ì§€ì‹ ë² ì´ìŠ¤ ë“±ë¡</button>
            </div>
        </div>
    </div>

    <div class="card p-0">
        <table class="table table-hover mb-0">
            <thead class="table-light">
                <tr>
                    <th class="ps-4">ID</th>
                    <th>ì—ëŸ¬ ì½”ë“œ</th>
                    <th>ìš”ì²­ ìƒì„¸ ìš”ê±´</th>
                    <th>í•´ê²° ë°©ë²•</th>
                    <th>ìƒíƒœ</th>
                    <th class="text-center pe-4">ê´€ë¦¬</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="case : ${cases}">
                    <td class="ps-4" th:text="${case.id}"></td>
                    <td><span class="badge bg-primary" th:text="${case.errorCode}"></span></td>
                    <td><div class="text-truncate-multiline" th:text="${case.requestDetail}"></div></td>
                    <td><div class="text-truncate-multiline" th:text="${case.resolution}"></div></td>
                    <td><span class="badge" th:classappend="${case.status == 'ì™„ë£Œ' ? 'bg-success' : 'bg-warning'}" th:text="${case.status}"></span></td>
                    <td class="text-center pe-4">
                        <button class="btn btn-sm btn-danger" th:onclick="'deleteCase(' + ${case.id} + ')'">ì‚­ì œ</button>
                    </td>
                </tr>
                <tr th:if="${#lists.isEmpty(cases)}">
                    <td colspan="6" class="text-center py-4 text-muted">ë“±ë¡ëœ ì‚¬ë¡€ê°€ ì—†ìŠµë‹ˆë‹¤.</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<script>
    async function saveCase() {
        const errorCode = document.getElementById('errorCode').value;
        const requestDetail = document.getElementById('requestDetail').value;
        const resolution = document.getElementById('resolution').value;
        const status = document.getElementById('status').value;

        if (!requestDetail || !resolution) {
            alert('ìš”ì²­ ìƒì„¸ ìš”ê±´ê³¼ í•´ê²° ë°©ë²•ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            return;
        }

        const response = await fetch('/api/v1/admin/cases', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ errorCode, requestDetail, resolution, status })
        });

        if (response.ok) {
            location.reload();
        } else {
            alert('ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
    }

    async function deleteCase(id) {
        if (!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

        const response = await fetch(`/api/v1/admin/cases/${id}`, {
            method: 'DELETE'
        });

        if (response.ok) {
            location.reload();
        } else {
            alert('ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
    }
</script>
</body>
</html>
